---
title: "Exploring World Bank Data"
author: "Gustavo Arruda Franco"
output: github_document
---

## Load necessary libraries

```{r}
library(tidyverse)
theme_set(theme_light())
```

## Write a function to import the data files

```{r}

import_data <- function(a){
  read_csv(a, skip = 4) %>% #Skip first 4 misleading rows
  select(-c(X65, `Indicator Name`)) %>% #Drop unnecessary columns
  pivot_longer(cols = c(4:63), names_to = "Year", names_transform = list(Year = as.double), values_to = "Value") %>% #Transform column names referencing years into a single numerical variable
  pivot_wider(names_from = "Indicator Code", values_from = "Value") %>% #Transform rows of Indicators into columns
  select("Country Name", "Year", GINI = "SI.POV.GINI", Military_Exp_GDP = "MS.MIL.XPND.GD.ZS") %>% #Select relevant variables
  drop_na() #Drop rows with empty values
}

```


## Import the data

```{r}

full_countries <- dir("data_world_bank", pattern = "\\.csv$", full.names = TRUE) #Save all file paths into a vector
wb_gini_military <- map_df(full_countries, import_data) #Iterate importing function through vector of file paths, creating an unified data frame

```

## Explore the data

```{r}

median_year <- group_by(wb_gini_military, Year) %>%
  summarize(Median_GINI_year = median(GINI),
            Median_Exp_year = median(Military_Exp_GDP))

gini_military_tier <- wb_gini_military %>%
  mutate(GINI_tiers = ifelse(GINI < 35, "Low Inequality", NA),
         GINI_tiers = ifelse(GINI >= 35 & GINI < 50, "Medium Inequality", GINI_tiers),
         GINI_tiers = ifelse(GINI >= 50, "High Inequality", GINI_tiers)) %>%
  group_by(Year, GINI_tiers) %>%
  summarize(Median_GINI_year = median(GINI),
            Median_Exp_year = median(Military_Exp_GDP))

ggplot(wb_gini_military, aes(y = GINI, x = Military_Exp_GDP)) +
  geom_density_2d() +
  labs(y = "GINI", x = "Military Expenditure/GDP", title = "Density of GINI x Military Expenditure/GDP Observations per Country per Year")
```

#ggplot(median_country, aes(y = Median_GINI_country, x = Median_Exp_country)) +
 # geom_density_2d() +
  #labs(y = "GINI", x = "Military Expenditure/GDP", title = "Density of GINI x Military Expenditure/GDP Observations per Country Median per Year")
  
  #Decent. Three perceptible clusters: very low military expenditure and high
#Gini closer to the left axis; dense area around 1.5% expenditure and 30 Gini; no apparent
#causality, but outliers are perpendicular not diagonal.
  
```{r}
ggplot(median_year, aes(x = Year, y = Median_GINI_year)) +
  geom_line() +
  geom_smooth() +
  labs(y = "Median of GINI", x = "Years", title = "Worldwide Median of GINI per Year")
```

```{r}
ggplot(median_year, aes(x = Year, y = Median_Exp_year)) +
  geom_line() +
  geom_smooth() +
  labs(y = "Median of Military Expenditure/GDP", x = "Years", title = "Worldwide Median of Military Expenditure/GDP per Year")
```

```{r}
ggplot(gini_military_tier, aes(x = Year, y = Median_Exp_year, color = GINI_tiers)) +
  geom_line() +
  labs(y = "Median of Military Expenditure/GDP", x = "Years", title = "Worldwide Median of Military Expenditure/GDP per Year", color = "Inequality Tiers")
  
```



## Session info

```{r}
devtools::session_info()
```


